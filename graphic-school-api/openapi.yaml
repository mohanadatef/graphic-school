openapi: 3.1.0
info:
  title: Graphic School LMS API
  description: |
    Complete API documentation for Graphic School Learning Management System.
    
    ## Authentication
    This API uses Laravel Sanctum for authentication. Include the Bearer token in the Authorization header:
    ```
    Authorization: Bearer {your-token}
    ```
    
    ## Response Format
    All responses follow a unified format:
    ```json
    {
      "success": true,
      "message": "Success message",
      "data": {},
      "errors": null,
      "status": 200,
      "meta": {}
    }
    ```
    
    ## Pagination
    Paginated responses include pagination metadata in the `meta.pagination` object.
    
    ## Rate Limiting
    Authentication endpoints are rate-limited to 5 requests per minute.
  version: 1.0.0
  contact:
    name: API Support
    email: support@graphicschool.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://graphic-school.test/api
    description: Local Development
  - url: https://api.graphicschool.com/api
    description: Production

tags:
  - name: Auth
    description: Authentication endpoints
  - name: Users
    description: User management
  - name: Roles & Permissions
    description: Role and permission management
  - name: Categories
    description: Course category management
  - name: Courses
    description: Course management
  - name: Curriculum
    description: Course curriculum (modules, lessons, resources)
  - name: Sessions
    description: Course session management
  - name: Attendance
    description: Attendance tracking
  - name: Enrollments
    description: Student enrollments
  - name: Certificates
    description: Certificate generation and management
  - name: Quizzes
    description: Quiz and assessment management
  - name: Projects
    description: Student project management
  - name: Media
    description: Media library management
  - name: Payments
    description: Payment processing and tracking
  - name: Reports
    description: Analytics and reporting
  - name: Settings
    description: System settings
  - name: Notifications
    description: In-app notifications
  - name: Messaging
    description: Student-Instructor messaging
  - name: CMS
    description: Content management (Pages, Sliders, Testimonials, FAQ, Contacts)
  - name: Localization
    description: Translation and localization
  - name: Tickets
    description: Support ticket system
  - name: Audit Logs
    description: System audit logs
  - name: Public
    description: Public-facing endpoints

paths:
  /health:
    get:
      tags:
        - Public
      summary: Health check
      description: Check API health status
      operationId: healthCheck
      responses:
        '200':
          description: API is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok
                  timestamp:
                    type: string
                    format: date-time

  /register:
    post:
      tags:
        - Auth
      summary: Register new user
      description: Register a new user account (default role: student)
      operationId: register
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RegisterRequest'
            example:
              name: "Ahmed Ali"
              email: "ahmed@example.com"
              password: "password123"
              phone: "+201234567890"
              address: "Cairo, Egypt"
      responses:
        '201':
          description: User registered successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '422':
          $ref: '#/components/responses/ValidationError'
      security: []

  /login:
    post:
      tags:
        - Auth
      summary: Login user
      description: Authenticate user and receive access token
      operationId: login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
            example:
              email: "admin@example.com"
              password: "password123"
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '422':
          $ref: '#/components/responses/ValidationError'
      security: []

  /logout:
    post:
      tags:
        - Auth
      summary: Logout user
      description: Invalidate current access token
      operationId: logout
      responses:
        '200':
          description: Logout successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
      security:
        - bearerAuth: []

  /admin/users:
    get:
      tags:
        - Users
      summary: List users
      description: Get paginated list of users with filters
      operationId: listUsers
      parameters:
        - $ref: '#/components/parameters/Page'
        - $ref: '#/components/parameters/PerPage'
        - $ref: '#/components/parameters/Search'
        - name: role_id
          in: query
          schema:
            type: integer
          description: Filter by role ID
        - name: is_active
          in: query
          schema:
            type: boolean
          description: Filter by active status
      responses:
        '200':
          description: Users retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PaginatedUserResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
      security:
        - bearerAuth: []
    
    post:
      tags:
        - Users
      summary: Create user
      description: Create a new user (Admin only)
      operationId: createUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateUserRequest'
      responses:
        '201':
          description: User created successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
        '422':
          $ref: '#/components/responses/ValidationError'
      security:
        - bearerAuth: []

  /admin/users/{id}:
    get:
      tags:
        - Users
      summary: Get user
      description: Get user details by ID
      operationId: getUser
      parameters:
        - $ref: '#/components/parameters/UserId'
      responses:
        '200':
          description: User retrieved successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
        '404':
          $ref: '#/components/responses/NotFound'
      security:
        - bearerAuth: []
    
    put:
      tags:
        - Users
      summary: Update user
      description: Update user information
      operationId: updateUser
      parameters:
        - $ref: '#/components/parameters/UserId'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateUserRequest'
      responses:
        '200':
          description: User updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/UserResponse'
        '422':
          $ref: '#/components/responses/ValidationError'
      security:
        - bearerAuth: []
    
    delete:
      tags:
        - Users
      summary: Delete user
      description: Delete a user
      operationId: deleteUser
      parameters:
        - $ref: '#/components/parameters/UserId'
      responses:
        '200':
          description: User deleted successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResponse'
        '404':
          $ref: '#/components/responses/NotFound'
      security:
        - bearerAuth: []

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: Laravel Sanctum Bearer Token

  parameters:
    Page:
      name: page
      in: query
      schema:
        type: integer
        minimum: 1
        default: 1
      description: Page number
    PerPage:
      name: per_page
      in: query
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 15
      description: Items per page
    Search:
      name: search
      in: query
      schema:
        type: string
      description: Search query
    UserId:
      name: id
      in: path
      required: true
      schema:
        type: integer
      description: User ID
    CourseId:
      name: course
      in: path
      required: true
      schema:
        type: integer
      description: Course ID

  schemas:
    SuccessResponse:
      type: object
      required:
        - success
        - message
        - status
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "Operation successful"
        data:
          type: object
          nullable: true
        errors:
          type: object
          nullable: true
        status:
          type: integer
          example: 200
        meta:
          type: object
          nullable: true

    ErrorResponse:
      type: object
      required:
        - success
        - message
        - status
      properties:
        success:
          type: boolean
          example: false
        message:
          type: string
          example: "Error message"
        data:
          type: object
          nullable: true
        errors:
          type: object
          nullable: true
          example:
            field:
              - "The field is required"
        status:
          type: integer
          example: 400

    PaginationMeta:
      type: object
      properties:
        current_page:
          type: integer
          example: 1
        per_page:
          type: integer
          example: 15
        total:
          type: integer
          example: 100
        last_page:
          type: integer
          example: 7
        from:
          type: integer
          example: 1
        to:
          type: integer
          example: 15

    RegisterRequest:
      type: object
      required:
        - name
        - email
        - password
      properties:
        name:
          type: string
          maxLength: 255
          example: "Ahmed Ali"
        email:
          type: string
          format: email
          maxLength: 255
          example: "ahmed@example.com"
        password:
          type: string
          minLength: 6
          example: "password123"
        phone:
          type: string
          maxLength: 30
          nullable: true
          example: "+201234567890"
        address:
          type: string
          maxLength: 255
          nullable: true
          example: "Cairo, Egypt"

    LoginRequest:
      type: object
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          example: "admin@example.com"
        password:
          type: string
          example: "password123"

    AuthResponse:
      allOf:
        - $ref: '#/components/schemas/SuccessResponse'
        - type: object
          properties:
            data:
              type: object
              properties:
                user:
                  $ref: '#/components/schemas/User'
                token:
                  type: string
                  example: "1|abcdefghijklmnopqrstuvwxyz1234567890"

    User:
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: "Ahmed Ali"
        email:
          type: string
          format: email
          example: "ahmed@example.com"
        phone:
          type: string
          nullable: true
          example: "+201234567890"
        avatar_path:
          type: string
          nullable: true
        bio:
          type: string
          nullable: true
        address:
          type: string
          nullable: true
        is_active:
          type: boolean
          example: true
        role_name:
          type: string
          example: "student"
        role_id:
          type: integer
          example: 3
        role:
          $ref: '#/components/schemas/Role'
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    UserResponse:
      allOf:
        - $ref: '#/components/schemas/SuccessResponse'
        - type: object
          properties:
            data:
              $ref: '#/components/schemas/User'

    PaginatedUserResponse:
      allOf:
        - $ref: '#/components/schemas/SuccessResponse'
        - type: object
          properties:
            data:
              type: array
              items:
                $ref: '#/components/schemas/User'
            meta:
              type: object
              properties:
                pagination:
                  $ref: '#/components/schemas/PaginationMeta'

    CreateUserRequest:
      type: object
      required:
        - name
        - email
        - password
        - role_id
      properties:
        name:
          type: string
          maxLength: 255
        email:
          type: string
          format: email
        password:
          type: string
          minLength: 6
        role_id:
          type: integer
        phone:
          type: string
          maxLength: 30
          nullable: true
        is_active:
          type: boolean
          default: true

    UpdateUserRequest:
      type: object
      properties:
        name:
          type: string
          maxLength: 255
        email:
          type: string
          format: email
        password:
          type: string
          minLength: 6
        role_id:
          type: integer
        phone:
          type: string
          maxLength: 30
        is_active:
          type: boolean

    Role:
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: "admin"
        display_name:
          type: string
          example: "Administrator"
        permissions:
          type: array
          items:
            type: string
          example: ["users.create", "users.update"]

  responses:
    Unauthorized:
      description: Unauthorized - Invalid or missing token
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            message: "Unauthorized"
            status: 401

    Forbidden:
      description: Forbidden - Insufficient permissions
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            message: "Forbidden"
            status: 403

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            message: "Resource not found"
            status: 404

    ValidationError:
      description: Validation error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            message: "Validation failed"
            errors:
              email:
                - "The email field is required"
            status: 422

